var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,d=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{u as r,a as s,d as o,g as n,b as u}from"./dept.d485bcdb.js";import{u as c,m as i,a as p,h as m}from"./index.b4c50d36.js";import{T as f,f as v}from"./validate.fea1858b.js";import{u as I}from"./useDrawer.8fe26ed9.js";import{d as h,r as b,a as g,f as y,j as w,n as C,t as _,a2 as k,l as S,m as N,v as j,q as x,a0 as O,Q as T,a1 as A,A as R,O as U}from"./ant-design-vue.10f2c163.js";const E=[{title:"部门名称",dataIndex:"deptName",key:"deptName"},{title:"排序",dataIndex:"orderNum",key:"orderNum",align:"center"},{title:"状态",dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var q=h({components:{Treeselect:f},setup(){const e=c(),a=b(),t={parentId:[{required:!0,validator:v.number,message:"上级部门不能为空",trigger:"change"}],deptName:[{required:!0,message:"部门名称不能为空",trigger:"blur"}],orderNum:[{required:!0,validator:v.number,message:"显示排序不能为空",trigger:"blur"}]},l=b(),d=b([]),i=b([]),p=()=>{n().then((a=>{const t=m(a.data.rows,"deptId","parentId","children",e.userInfo.deptId).tree,l=a.data.rows.filter((a=>a.deptId===e.userInfo.deptId));l[0].children=t,i.value=l,d.value=l}))},f=g({deptId:void 0,parentId:void 0,deptName:void 0,orderNum:"1",status:"1"}),{open:h,drawerTitle:_}=I();return y((()=>{p()})),{deptList:i,confirm:e=>{o(e.deptId).then((()=>{p(),w.success("删除成功")}))},cancel:e=>{console.log(e),w.success("取消删除")},columns:E,handleAdd:t=>{n().then((l=>{l.data.rows.forEach((e=>{e.isDisabled=!1}));const r=m(l.data.rows,"deptId","parentId","children",e.userInfo.deptId).tree,s=l.data.rows.filter((a=>a.deptId===e.userInfo.deptId));s[0].children=r,i.value=s,d.value=s,h.value=!0,_.value="添加部门",null!=t&&t.deptId&&C((()=>{f.parentId=t.deptId,a.value&&a.value.forest.selectedNodeIds.push(t.deptId)}))}))},handleUpdate:t=>{n().then((l=>{l.data.rows.forEach((e=>{e.deptId===t.deptId?e.isDisabled=!0:e.isDisabled=!1}));const r=m(l.data.rows,"deptId","parentId","children",e.userInfo.deptId).tree,s=l.data.rows.filter((a=>a.deptId===e.userInfo.deptId));s[0].children=r,i.value=s,d.value=s,u(t.deptId).then((e=>{h.value=!0,_.value="修改部门",C((()=>{Object.keys(f).forEach((a=>{f[a]=e.data[a]})),a.value.forest.selectedNodeIds.push(e.data.parentId)}))}))}))},open:h,drawerTitle:_,handleClose:()=>{f.deptId=void 0,l.value.resetFields(),console.log(f),h.value=!1},handleSubmit:()=>{console.log(f),l.value.validate().then((()=>{f.deptId?r(f).then((e=>{w.success(e.message),p(),f.deptId=void 0,l.value.resetFields(),h.value=!1})):s(f).then((e=>{w.success(e.message),p(),f.deptId=void 0,l.value.resetFields(),h.value=!1}))})).catch((e=>{console.log("error",e)}))},formState:f,labelCol:{span:6},wrapperCol:{span:18},normalizer:e=>(e.children&&!e.children.length&&delete e.children,{id:e.deptId,label:e.deptName,children:e.children}),deptOptions:d,rules:t,formRef:l,treeRef:a,handleTreeSelect:e=>{f.parentId=e.deptId}}},computed:((e,r)=>{for(var s in r||(r={}))t.call(r,s)&&d(e,s,r[s]);if(a)for(var s of a(r))l.call(r,s)&&d(e,s,r[s]);return e})({},i(p,["loading"]))});const z={class:"p-4"},D=U("新增"),F={class:"flex justify-center"},P={class:"flex justify-center"},L=U(" 新增 "),K=U(" 修改 "),Q=U(" 删除 "),B=U(" 确认 "),G=U("取消");q.render=function(e,a,t,l,d,r){const s=_("a-button"),o=_("a-col"),n=_("a-row"),u=_("svg-icon"),c=_("a-popconfirm"),i=_("a-table"),p=_("treeselect"),m=_("a-form-item"),f=_("a-input"),v=_("a-input-number"),I=_("a-radio-group"),h=_("a-form"),b=_("a-drawer"),g=k("has-permi");return S(),N("div",z,[j(n,{gutter:10,class:"mb-2"},{default:x((()=>[O(j(o,null,{default:x((()=>[j(s,{color:"success",onClick:e.handleAdd},{default:x((()=>[D])),_:1},8,["onClick"])])),_:1},512),[[g,["system:department:add"]]])])),_:1}),j(i,{loading:e.loading,rowKey:"deptId",columns:e.columns,"data-source":e.deptList,defaultExpandAllRows:!0,pagination:!1},{icon:x((({record:e})=>[j("div",F,[j(u,{name:e.icon},null,8,["name"])])])),status:x((({record:e})=>[j("div",P,[j("span",null,T("1"===e.status?"正常":"停用"),1)])])),action:x((({record:a})=>[j("span",null,[O(j(s,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleAdd(a)},{default:x((()=>[L])),_:2},1032,["onClick"]),[[g,["system:department:add"]]]),O(j(s,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleUpdate(a)},{default:x((()=>[K])),_:2},1032,["onClick"]),[[g,["system:department:update"]]]),j(c,{title:"确定要删除该数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:t=>e.confirm(a),onCancel:e.cancel},{default:x((()=>[O(j(s,{type:"link",color:"error"},{default:x((()=>[Q])),_:1},512),[[g,["system:department:delete"]]])])),_:2},1032,["onConfirm","onCancel"])])])),_:1},8,["loading","columns","data-source"]),j(b,{width:"50%",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[5]||(a[5]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:x((()=>[e.open?(S(),N(h,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:x((()=>[j(n,null,{default:x((()=>[O(j(o,{span:12},{default:x((()=>[j(m,{label:"上级部门",name:"parentId"},{default:x((()=>[j(p,{ref:"treeRef",class:"!mt-[3px]",value:e.formState.parentId,"onUpdate:value":a[1]||(a[1]=a=>e.formState.parentId=a),normalizer:e.normalizer,placeholder:"请选择上级部门",options:e.deptOptions,onSelect:e.handleTreeSelect},null,8,["value","normalizer","options","onSelect"])])),_:1})])),_:1},512),[[A,0!==e.formState.parentId]]),j(o,{span:12},{default:x((()=>[j(m,{label:"部门名称",name:"deptName"},{default:x((()=>[j(f,{value:e.formState.deptName,"onUpdate:value":a[2]||(a[2]=a=>e.formState.deptName=a),placeholder:"请输入部门名称"},null,8,["value"])])),_:1})])),_:1}),j(o,{span:12},{default:x((()=>[j(m,{label:"显示排序",name:"orderNum"},{default:x((()=>[j(v,{class:"!w-[100%]",value:e.formState.orderNum,"onUpdate:value":a[3]||(a[3]=a=>e.formState.orderNum=a),placeholder:"请输入显示排序"},null,8,["value"])])),_:1})])),_:1}),j(o,{span:12},{default:x((()=>[j(m,{label:"部门状态",name:"status"},{default:x((()=>[j(I,{value:e.formState.status,"onUpdate:value":a[4]||(a[4]=a=>e.formState.status=a),name:"menuType",options:[{label:"正常",value:"1"},{label:"停用",value:"0"}]},null,8,["value"])])),_:1})])),_:1}),j(o,{span:24},{default:x((()=>[j(m,null,{default:x((()=>[j(s,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:x((()=>[B])),_:1},8,["onClick"]),j(s,{onClick:e.handleClose},{default:x((()=>[G])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","label-col","wrapper-col"])):R("",!0)])),_:1},8,["title","visible","onClose"])])};export default q;
