var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{u as t,d as r,m as n}from"./index.b4c50d36.js";import{l as u,p as i}from"./esm.531ddd84.js";import{u as d,a as c,b as m,c as p}from"./user.ffc71706.js";import{d as f}from"./profile.33bddddf.js";import{d as b,r as v,a as w,j as g,V as y,W as h,l as k,m as I,v as S,Q as C,a0 as P,a1 as _,F as x,y as j,O as U,t as N,a2 as F,q as R,U as O,S as D}from"./ant-design-vue.10f2c163.js";var K=b({components:{VuePictureCropper:u},setup(){const e=t(),a=r;console.log(e);const l=v(),o=w({nickName:e.userInfo.nickName,mobile:e.userInfo.mobile,email:e.userInfo.email,sex:e.userInfo.sex}),s=v(""),n=v(""),u=v(null),p=v(!1);return{baseImgUrl:a,defaultAvatar:f,getRoleName:e=>e.map((e=>e.roleName)).join(),formState:o,formRef:l,resetForm:()=>{l.value.resetFields()},handleSubmit:()=>{l.value.validate().then((()=>{console.log("values",o);const a={nickName:e.userInfo.nickName,mobile:e.userInfo.mobile,email:e.userInfo.email,sex:e.userInfo.sex,roleIds:[]};Object.keys(e.userInfo).forEach((l=>{a[l]=e.userInfo[l]})),a.nickName=o.nickName,a.mobile=o.mobile,a.email=o.email,a.sex=o.sex,a.roleIds=e.userInfo.roles.map((e=>e.id)),d(a).then((e=>{g.success(e.message),window.location.reload()}))})).catch((e=>{console.log("error",e)}))},selectFile:e=>{const a=e.target,{files:l}=a;if(!l)return;const o=l[0],t=new FileReader;t.readAsDataURL(o),t.onload=()=>{s.value=String(t.result)}},getResult:()=>{const a=i.getDataURL(),l=i.getBlob();console.log({base64:a,blob:l}),n.value=a;const o=new FormData;console.log(u.value.files[0].name,u.value.files[0].type);const s=new window.File([l],u.value.files[0].name,{type:u.value.files[0].type});o.append("file",s),c(o).then((a=>{console.log(a);const l={avatar:a.data.path};m(e.userInfo.id,l).then((e=>{g.success(e.message),p.value=!1,window.location.reload()}))})).catch((e=>{console.log(e)}))},isShowDialog:p,pic:s,uploadInput:u,handleCancle:()=>{u.value&&(u.value.value=""),s.value="",n.value="",p.value=!1}}},computed:((e,t)=>{for(var r in t||(t={}))l.call(t,r)&&s(e,r,t[r]);if(a)for(var r of a(t))o.call(t,r)&&s(e,r,t[r]);return e})({},n(t,["userInfo"]))});const q=j("data-v-78861d25");y("data-v-78861d25");const A={class:"flex justify-center"},E={class:"flex justify-between border-b border-b-[#e7eaec] pt-2 pb-2"},L=S("span",null,"用户名",-1),M={class:"flex justify-between border-b border-b-[#e7eaec] pt-2 pb-2"},V=S("span",null,"手机号",-1),B={class:"flex justify-between border-b border-b-[#e7eaec] pt-2 pb-2"},Q=S("span",null,"用户邮箱",-1),W={class:"flex justify-between border-b border-b-[#e7eaec] pt-2 pb-2"},z=S("span",null,"所属部门",-1),G={class:"flex justify-between border-b border-b-[#e7eaec] pt-2 pb-2"},H=S("span",null,"角色",-1),J={class:"flex justify-between border-b border-b-[#e7eaec] pt-2 pb-2"},T=S("span",null,"创建日期",-1),X=U(" 保存修改 "),Y=U("重置"),Z=S("span",null,"选择图片",-1),$=U(" 上传 "),ee={class:"flex justify-between"},ae={class:"text-center w-[100%] text-color-[#999]"},le={class:"preview",ref:"preview"};h();const oe=q(((e,a,l,o,s,t)=>{const r=N("a-card"),n=N("a-col"),u=N("a-input"),i=N("a-form-item"),d=N("a-radio-group"),c=N("a-button"),m=N("a-form"),p=N("a-row"),f=N("vue-picture-cropper"),b=N("a-modal"),v=F("has-permi");return k(),I(x,null,[S(p,{gutter:24},{default:q((()=>[S(n,{span:8},{default:q((()=>[S(r,{title:"基本信息"},{default:q((()=>[S("div",A,[S("img",{onClick:a[1]||(a[1]=a=>e.isShowDialog=!0),class:"rounded-full block w-50 h-50",src:e.userInfo.avatar?e.baseImgUrl+e.userInfo.avatar:e.defaultAvatar,alt:""},null,8,["src"])]),S("ul",null,[S("li",E,[L,S("span",null,C(e.userInfo.userName),1)]),S("li",M,[V,S("span",null,C(e.userInfo.mobile),1)]),S("li",B,[Q,S("span",null,C(e.userInfo.email),1)]),S("li",W,[z,S("span",null,C(e.userInfo.department.deptName),1)]),S("li",G,[H,S("span",null,C(e.getRoleName(e.userInfo.roles)),1)]),S("li",J,[T,S("span",null,C(e.userInfo.createdAt),1)])])])),_:1})])),_:1}),S(n,{span:16},{default:q((()=>[S(r,{title:"信息修改"},{default:q((()=>[S(m,{name:"custom-validation",ref:"formRef",model:e.formState},{default:q((()=>[S(i,{"has-feedback":"",label:"用户昵称",name:"nickName"},{default:q((()=>[S(u,{value:e.formState.nickName,"onUpdate:value":a[2]||(a[2]=a=>e.formState.nickName=a),placeholder:"请输入用户昵称"},null,8,["value"])])),_:1}),S(i,{"has-feedback":"",label:"手机号码",name:"mobile"},{default:q((()=>[S(u,{value:e.formState.mobile,"onUpdate:value":a[3]||(a[3]=a=>e.formState.mobile=a),placeholder:"请输入手机号码"},null,8,["value"])])),_:1}),S(i,{"has-feedback":"",label:"用户邮箱",name:"email"},{default:q((()=>[S(u,{value:e.formState.email,"onUpdate:value":a[4]||(a[4]=a=>e.formState.email=a),placeholder:"请输入邮箱"},null,8,["value"])])),_:1}),S(i,{"has-feedback":"",label:"性别",name:"sex"},{default:q((()=>[S(d,{value:e.formState.sex,"onUpdate:value":a[5]||(a[5]=a=>e.formState.sex=a),options:[{label:"男",value:"1"},{label:"女",value:"0"}]},null,8,["value"])])),_:1}),S(i,null,{default:q((()=>[P(S(c,{type:"primary","html-type":"submit",class:"mr-3",onClick:e.handleSubmit},{default:q((()=>[X])),_:1},8,["onClick"]),[[v,["system:user:update"]]]),S(c,{onClick:e.resetForm},{default:q((()=>[Y])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),S(b,{visible:e.isShowDialog,"onUpdate:visible":a[7]||(a[7]=a=>e.isShowDialog=a),title:"上传图片",maskClosable:!1,width:"750px",onCancel:e.handleCancle},{footer:q((()=>[S(c,{class:"select-picture"},{default:q((()=>[Z,S("input",{class:"absolute top-0 left-0 w-[100%] h-[100%] opacity-0",ref:"uploadInput",type:"file",accept:"image/jpg, image/jpeg, image/png, image/gif",onChange:a[6]||(a[6]=(...a)=>e.selectFile&&e.selectFile(...a))},null,544)])),_:1}),P(S(c,{type:"primary",onClick:e.getResult},{default:q((()=>[$])),_:1},8,["onClick"]),[[v,["system:user:update"]]])])),default:q((()=>[S("div",ee,[P(S("p",ae," 请选择图片 ",512),[[_,!e.pic]]),P(S(f,{boxStyle:{width:"75%",height:"100%",backgroundColor:"#f8f8f8",margin:"auto"},img:e.pic,options:{viewMode:1,dragMode:"crop",aspectRatio:1,preview:".preview"}},null,8,["img","options"]),[[_,e.pic]]),P(S("div",le,[S("img",{src:e.result,alt:""},null,8,["src"])],512),[[_,e.pic]])])])),_:1},8,["visible","onCancel"])],64)}));K.render=oe,K.__scopeId="data-v-78861d25";var se=b({setup(){const e=v(),a=t(),l=w({oldPassword:void 0,newPassword:void 0,confirmPassword:void 0});return{formState:l,formRef:e,rules:{oldPassword:[{required:!0,message:"旧密码不能为空",trigger:"blur"}],newPassword:[{required:!0,message:"新密码不能为空",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,validator:(e,a)=>l.newPassword!==a?Promise.reject("两次密码不一致"):Promise.resolve(),trigger:"change"}]},layout:{labelCol:{span:6},wrapperCol:{span:18}},resetForm:()=>{e.value.resetFields()},handleSubmit:()=>{e.value.validate().then((()=>{console.log("values",l);const e={password:l.oldPassword,newPassword:l.newPassword};p(a.userInfo.id,e).then((e=>{g.success(e.message)}))})).catch((e=>{console.log("error",e)}))}}}});const te=U(" 保存修改 "),re=U("重置");se.render=function(e,a,l,o,s,t){const r=N("a-input-password"),n=N("a-form-item"),u=N("a-button"),i=N("a-form"),d=F("has-permi");return k(),I(i,{name:"custom-validation",ref:"formRef",model:e.formState,rules:e.rules,labelCol:e.layout.labelCol,wrapperCol:e.layout.wrapperCol,class:"w-100"},{default:R((()=>[S(n,{"has-feedback":"",label:"原始密码",name:"oldPassword"},{default:R((()=>[S(r,{value:e.formState.oldPassword,"onUpdate:value":a[1]||(a[1]=a=>e.formState.oldPassword=a),placeholder:"请输入原始密码",type:"password"},null,8,["value"])])),_:1}),S(n,{"has-feedback":"",label:"新密码",name:"newPassword"},{default:R((()=>[S(r,{value:e.formState.newPassword,"onUpdate:value":a[2]||(a[2]=a=>e.formState.newPassword=a),placeholder:"请输入新密码",type:"password"},null,8,["value"])])),_:1}),S(n,{"has-feedback":"",label:"确认密码",name:"confirmPassword"},{default:R((()=>[S(r,{value:e.formState.confirmPassword,"onUpdate:value":a[3]||(a[3]=a=>e.formState.confirmPassword=a),placeholder:"请输入确认新密码",type:"password"},null,8,["value"])])),_:1}),S(n,null,{default:R((()=>[P(S(u,{type:"primary","html-type":"submit",class:"mr-3",onClick:e.handleSubmit},{default:R((()=>[te])),_:1},8,["onClick"]),[[d,["system:user:update"]]]),S(u,{onClick:e.resetForm},{default:R((()=>[re])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules","labelCol","wrapperCol"])};var ne=b({components:{UserInfo:K,UpdatePwd:se},setup:()=>({activeKey:v(1),tabs:[{key:1,title:"个人信息",component:"UserInfo"},{key:2,title:"修改密码",component:"UpdatePwd"}]})});const ue={class:"p-4"};ne.render=function(e,a,l,o,s,t){const r=N("a-tab-pane"),n=N("a-tabs");return k(),I("div",ue,[S(n,{"tab-position":"left",activeKey:e.activeKey,"onUpdate:activeKey":a[1]||(a[1]=a=>e.activeKey=a)},{default:R((()=>[(k(!0),I(x,null,O(e.tabs,(e=>(k(),I(r,{key:e.key,tab:e.title},{default:R((()=>[(k(),I(D(e.component)))])),_:2},1032,["tab"])))),128))])),_:1},8,["activeKey"])])};export default ne;
