var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,d=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))r.call(a,l)&&o(e,l,a[l]);return e},n=(e,t)=>a(e,l(t));import{_ as i,g as u,s as c}from"./index.b7715d33.js";import{g as p}from"./dept.d485bcdb.js";import{g as m,d as f,l as v,u as h,e as g,r as b}from"./user.ffc71706.js";import{g as y}from"./role.a973b686.js";import{u as w,m as S,a as _,h as k}from"./index.b4c50d36.js";import{u as I}from"./useDrawer.8fe26ed9.js";import{T as C,f as x}from"./validate.fea1858b.js";import{d as N,r as O,c as R,b as U,t as K,l as P,m as j,v as T,q as F,O as z,Q as q,F as E,a as V,f as A,a3 as D,n as L,j as Q,a2 as M,a0 as $,a1 as B,A as G,U as H}from"./ant-design-vue.10f2c163.js";var J=N({props:{data:{type:Array,required:!0},original:{type:Array,default:()=>[]},baseFields:{type:Object,default:()=>({children:"children",title:"title",key:"id"})}},emits:["select"],setup(e,{emit:a}){const l=O(""),t=O([]),s=O([]),r=O(!0),o=R((()=>e.data)),d=R((()=>e.baseFields)),n=R((()=>e.original));return U(l,(e=>{const a=n.value.map((a=>a.deptName.indexOf(e)>-1?a.deptId:null)).filter(((e,a,l)=>e&&l.indexOf(e)===a));s.value=a,l.value=e,r.value=!0})),U(t,(e=>{console.log("selectedKeys",e)})),{searchValue:l,expandedKeys:s,autoExpandParent:r,deptTreeOption:o,replaceFields:d,selectedKeys:t,onExpand:e=>{s.value=e,r.value=!1},handleSelect:e=>{a("select",e)}}}});const W={key:0},X={class:"text-red-400"},Y={key:1};J.render=function(e,a,l,t,s,r){const o=K("svg-icon"),d=K("a-input"),n=K("a-tree");return P(),j(E,null,[T(d,{allowClear:!0,value:e.searchValue,"onUpdate:value":a[1]||(a[1]=a=>e.searchValue=a),placeholder:"请输入部门名称"},{prefix:F((()=>[T(o,{name:"search",class:"text-[#d9d9d9]"})])),_:1},8,["value"]),T(n,{blockNode:!0,expandedKeys:e.expandedKeys,"auto-expand-parent":e.autoExpandParent,"replace-fields":e.replaceFields,"tree-data":e.deptTreeOption,selectedKeys:e.selectedKeys,"onUpdate:selectedKeys":a[2]||(a[2]=a=>e.selectedKeys=a),onExpand:e.onExpand,onSelect:e.handleSelect},{title:F((({deptName:a})=>[a.indexOf(e.searchValue)>-1?(P(),j("span",W,[z(q(a.substr(0,a.indexOf(e.searchValue)))+" ",1),T("span",X,q(e.searchValue),1),z(" "+q(a.substr(a.indexOf(e.searchValue)+e.searchValue.length)),1)])):(P(),j("span",Y,q(a),1))])),_:1},8,["expandedKeys","auto-expand-parent","replace-fields","tree-data","selectedKeys","onExpand","onSelect"])],64)};const Z=[{title:"用户名",dataIndex:"userName",key:"userName",align:"center"},{title:"昵称",dataIndex:"nickName",key:"nickName",align:"center"},{title:"角色",key:"roles",align:"center",slots:{customRender:"roles"}},{title:"部门",key:"department",align:"center",slots:{customRender:"department"}},{title:"手机号",key:"mobile",dataIndex:"mobile",align:"center"},{title:"状态",dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var ee=N({components:{Treeselect:C,DeptSearch:J,FormSearch:i},setup(){const e=w(),a=O([]),l=O(),t=O([]),s=O([]),r=O(),o=V({userName:"",deptId:0,roleId:"",pageNum:1,pageSize:10}),i=V([{type:"input",label:"用户名",name:"userName",value:void 0,placeholder:"请输入用户名"},{type:"select",label:"角色",name:"roleId",value:void 0,placeholder:"请选择角色",normalizer:{value:"id",label:"roleName"},options:a}]),S=e=>{U.value.current=1,o.pageNum=U.value.current,o.userName=e.userName,o.roleId=e.roleId,j(o)},_=O([]),C=V({selectedRowKeys:[]}),N=O([]),U=O({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),K=R((()=>C.selectedRowKeys.length>0)),P=O([]),j=a=>{v(a).then((e=>{console.log(e),N.value=e.data.rows,U.value.total=e.data.count})),p().then((a=>{const l=k(a.data.rows,"deptId","parentId","children",e.userInfo.deptId).tree,t=a.data.rows.filter((a=>a.deptId===e.userInfo.deptId));t[0].children=l,P.value=t,console.log(P)}))},T=O(),F=V({id:void 0,deptId:void 0,nickName:void 0,userName:void 0,password:void 0,sex:"1",roleIds:[],mobile:void 0,status:"1",email:void 0,remark:void 0}),z={deptId:[{required:!0,validator:x.number,message:"归属部门不能为空",trigger:"change"}],nickName:[{required:!0,message:"昵称不能为空",trigger:"blur"}],userName:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],roleIds:[{required:!0,validator:x.checkRoleLength,trigger:"change"}]},{open:q,drawerTitle:E}=I(),M=O(!1),$=O(),B=O(!1),G=V({id:0,newPassword:""}),H=()=>{p().then((e=>{t.value=e.data.rows,s.value=k(e.data.rows,"deptId","parentId","children",0).tree,l.value.expandedKeys.value=t.value.map((e=>e.id))})),j(o),y().then((e=>{a.value=e.data.rows}))};return A((async()=>{_.value=await u("sys_normal_disable"),H()})),n(d(n(d({replaceFields:{children:"children",title:"deptName",key:"deptId"},deptSearchRef:l,originalTree:t,deptTreeOption:s,handleSelect:e=>{o.deptId=e[0],S(o)},queryRef:r,queryParams:o,formFields:i,handleQuery:S,statusOptions:_,columns:Z},D(C)),{userList:N,pagination:U,handleTableChange:e=>{U.value=e,o.pageNum=U.value.current,o.pageSize=U.value.pageSize,j(o)},selectDictLabel:c,hasSelected:K,onSelectChange:e=>{C.selectedRowKeys=e},getRoles:e=>e.roles.map((e=>e.roleName)).join(","),confirm:e=>{const a=e.id||C.selectedRowKeys;console.log(a),f(a).then((()=>{j(o),Q.success("删除成功")}))},cancel:e=>{console.log(e),Q.success("取消删除")},handleAdd:()=>{q.value=!0,M.value=!1,E.value="添加字典"},handleUpdate:e=>{m(e.id).then((e=>{q.value=!0,M.value=!0,E.value="修改字典",L((()=>{Object.keys(F).forEach((a=>{F[a]=e.data[a]})),F.roleIds=e.data.roles.map((e=>e.id)),T.value.forest.selectedNodeIds.push(e.data.deptId),console.log(F)}))}))},treeRef:T,formRef:$,rules:z,isUpdate:M,open:q,drawerTitle:E,deptOptions:P,normalizer:e=>(e.children&&!e.children.length&&delete e.children,{id:e.deptId,label:e.deptName,children:e.children}),handleClose:()=>{F.id=void 0,F.deptId=void 0,$.value.resetFields(),console.log(F),q.value=!1},handleSubmit:()=>{console.log(F),$.value.validate().then((()=>{F.id?h(F).then((e=>{Q.success(e.message),F.id=void 0,F.roleIds=void 0,$.value.resetFields(),q.value=!1,j(o)})):g(F).then((e=>{Q.success(e.message),F.id=void 0,F.roleIds=void 0,$.value.resetFields(),q.value=!1,j(o)}))})).catch((e=>{console.log("error",e)}))},labelCol:{span:6},wrapperCol:{span:18},formState:F,roleOptions:a,handleTreeSelect:e=>{F.deptId=e.deptId},visible:B}),D(G)),{handleResetPwd:()=>{G.newPassword?b(G.id,{newPassword:G.newPassword}).then((e=>{Q.success(e.message),G.newPassword="",B.value=!1})):Q.error("新密码不能为空")},handleResetClose:()=>{G.newPassword="",B.value=!1},showModal:e=>{G.id=e.id,B.value=!0}})},computed:d({},S(_,["loading"]))});const ae={class:"p-4"},le={class:"mb-3"},te=z(" 新增 "),se=z(" 删除 "),re=z("导入"),oe=z("导出"),de=z(" 修改 "),ne=z(" 重置密码 "),ie=z(" 删除 "),ue=z(" 确认 "),ce=z("取消"),pe={class:"flex items-center"},me=T("span",{class:"whitespace-nowrap"},"新密码：",-1);ee.render=function(e,a,l,t,s,r){const o=K("dept-search"),d=K("a-col"),n=K("form-search"),i=K("a-button"),u=K("a-popconfirm"),c=K("a-row"),p=K("a-table"),m=K("treeselect"),f=K("a-form-item"),v=K("a-input"),h=K("a-input-password"),g=K("a-select-option"),b=K("a-select"),y=K("a-radio-group"),w=K("a-textarea"),S=K("a-form"),_=K("a-drawer"),k=K("a-modal"),I=M("has-permi");return P(),j("div",ae,[T(c,{gutter:15},{default:F((()=>[T(d,{span:4},{default:F((()=>[T(o,{ref:"deptSearchRef",original:e.originalTree,data:e.deptTreeOption,baseFields:e.replaceFields,onSelect:e.handleSelect},null,8,["original","data","baseFields","onSelect"])])),_:1}),T(d,{span:20},{default:F((()=>[T("div",le,[T(n,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),T(c,{gutter:10,class:"mb-2"},{default:F((()=>[$(T(d,null,{default:F((()=>[T(i,{color:"success",onClick:e.handleAdd},{default:F((()=>[te])),_:1},8,["onClick"])])),_:1},512),[[I,["system:user:add"]]]),$(T(d,null,{default:F((()=>[T(u,{title:"确定要删除选中数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e.confirm,onCancel:e.cancel},{default:F((()=>[T(i,{disabled:!e.hasSelected,color:"error"},{default:F((()=>[se])),_:1},8,["disabled"])])),_:1},8,["onConfirm","onCancel"])])),_:1},512),[[I,["system:user:delete"]]]),T(d,null,{default:F((()=>[T(i,{color:"warning"},{default:F((()=>[re])),_:1})])),_:1}),T(d,null,{default:F((()=>[T(i,{color:"normal"},{default:F((()=>[oe])),_:1})])),_:1})])),_:1}),T(p,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.userList,pagination:e.pagination,onChange:e.handleTableChange},{department:F((({record:e})=>[T("span",null,q(e.department.deptName),1)])),status:F((({record:a})=>[T("span",null,q(e.selectDictLabel(e.statusOptions,a.status)),1)])),roles:F((({record:a})=>[T("span",null,q(e.getRoles(a)),1)])),action:F((({record:a})=>[T("span",null,[$(T(i,{type:"link",color:"success",class:"mr-3",onClick:l=>e.handleUpdate(a)},{default:F((()=>[de])),_:2},1032,["onClick"]),[[I,["system:user:update"]]]),$(T(i,{type:"link",color:"success",class:"mr-3",onClick:l=>e.showModal(a)},{default:F((()=>[ne])),_:2},1032,["onClick"]),[[I,["system:user:resetPwd"]]]),T(u,{title:"确定要删除该数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:l=>e.confirm(a),onCancel:e.cancel},{default:F((()=>[$(T(i,{type:"link",color:"error"},{default:F((()=>[ie])),_:1},512),[[I,["system:user:delete"]]])])),_:2},1032,["onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"])])),_:1})])),_:1}),T(_,{width:"50%",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[11]||(a[11]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:F((()=>[e.open?(P(),j(S,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:F((()=>[T(c,null,{default:F((()=>[$(T(d,{span:12},{default:F((()=>[T(f,{label:"归属部门",name:"deptId"},{default:F((()=>[T(m,{ref:"treeRef",class:"!mt-[3px]",value:e.formState.deptId,"onUpdate:value":a[1]||(a[1]=a=>e.formState.deptId=a),normalizer:e.normalizer,placeholder:"请选择归属部门",options:e.deptOptions,onSelect:e.handleTreeSelect},null,8,["value","normalizer","options","onSelect"])])),_:1})])),_:1},512),[[B,0!==e.formState.deptId]]),T(d,{span:12},{default:F((()=>[T(f,{label:"昵称",name:"nickName"},{default:F((()=>[T(v,{value:e.formState.nickName,"onUpdate:value":a[2]||(a[2]=a=>e.formState.nickName=a),placeholder:"请输入昵称"},null,8,["value"])])),_:1})])),_:1}),e.isUpdate?G("",!0):(P(),j(d,{key:0,span:12},{default:F((()=>[T(f,{label:"用户名",name:"userName"},{default:F((()=>[T(v,{value:e.formState.userName,"onUpdate:value":a[3]||(a[3]=a=>e.formState.userName=a),placeholder:"请输入用户名"},null,8,["value"])])),_:1})])),_:1})),e.isUpdate?G("",!0):(P(),j(d,{key:1,span:12},{default:F((()=>[T(f,{label:"密码",name:"password"},{default:F((()=>[T(h,{value:e.formState.password,"onUpdate:value":a[4]||(a[4]=a=>e.formState.password=a),placeholder:"请输入密码"},null,8,["value"])])),_:1})])),_:1})),T(d,{span:12},{default:F((()=>[T(f,{label:"角色",name:"roleIds"},{default:F((()=>[T(b,{mode:"multiple",value:e.formState.roleIds,"onUpdate:value":a[5]||(a[5]=a=>e.formState.roleIds=a),placeholder:"请选择角色"},{default:F((()=>[(P(!0),j(E,null,H(e.roleOptions,(e=>(P(),j(g,{key:e.id},{default:F((()=>[z(q(e.roleName),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1})])),_:1}),T(d,{span:12},{default:F((()=>[T(f,{label:"性别",name:"sex"},{default:F((()=>[T(y,{value:e.formState.sex,"onUpdate:value":a[6]||(a[6]=a=>e.formState.sex=a),name:"menuType",options:[{label:"男",value:"1"},{label:"女",value:"0"}]},null,8,["value"])])),_:1})])),_:1}),T(d,{span:12},{default:F((()=>[T(f,{label:"手机号码",name:"mobile"},{default:F((()=>[T(v,{value:e.formState.mobile,"onUpdate:value":a[7]||(a[7]=a=>e.formState.mobile=a),placeholder:"请输入手机号码"},null,8,["value"])])),_:1})])),_:1}),T(d,{span:12},{default:F((()=>[T(f,{label:"状态",name:"status"},{default:F((()=>[T(y,{value:e.formState.status,"onUpdate:value":a[8]||(a[8]=a=>e.formState.status=a),name:"menuType",options:[{label:"正常",value:"1"},{label:"停用",value:"0"}]},null,8,["value"])])),_:1})])),_:1}),T(d,{span:12},{default:F((()=>[T(f,{label:"邮箱",name:"email"},{default:F((()=>[T(v,{value:e.formState.email,"onUpdate:value":a[9]||(a[9]=a=>e.formState.email=a),placeholder:"请输入邮箱"},null,8,["value"])])),_:1})])),_:1}),T(d,{span:12},{default:F((()=>[T(f,{label:"备注",name:"remark"},{default:F((()=>[T(w,{rows:3,value:e.formState.remark,"onUpdate:value":a[10]||(a[10]=a=>e.formState.remark=a),placeholder:"请输入备注"},null,8,["value"])])),_:1})])),_:1}),T(d,{span:24},{default:F((()=>[T(f,null,{default:F((()=>[T(i,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:F((()=>[ue])),_:1},8,["onClick"]),T(i,{onClick:e.handleClose},{default:F((()=>[ce])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","label-col","wrapper-col"])):G("",!0)])),_:1},8,["title","visible","onClose"]),T(k,{visible:e.visible,"onUpdate:visible":a[13]||(a[13]=a=>e.visible=a),title:"重置密码",onOk:e.handleResetPwd,onCancel:e.handleResetClose},{default:F((()=>[T("div",pe,[me,T(h,{value:e.newPassword,"onUpdate:value":a[12]||(a[12]=a=>e.newPassword=a),placeholder:"请输入密码"},null,8,["value"])])])),_:1},8,["visible","onOk","onCancel"])])};export default ee;
