var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))r.call(a,l)&&s(e,l,a[l]);return e};import{g as d,u as c,a as u,d as i,b as p}from"./role.a973b686.js";import{m,a as f,f as v,h}from"./index.b4c50d36.js";import{_ as b,g,s as y}from"./index.b7715d33.js";import{u as S}from"./useDrawer.8fe26ed9.js";import{d as k,r as _,a as C,c as w,f as K,a3 as O,j as N,n as R,t as x,a2 as j,l as I,m as U,v as F,q as P,a0 as q,Q as T,A as z,F as A,U as D,O as L}from"./ant-design-vue.10f2c163.js";const E=[{title:"角色名称",dataIndex:"roleName",key:"roleName",align:"center"},{title:"权限字符",dataIndex:"roleKey",key:"roleKey",align:"center"},{title:"显示顺序",dataIndex:"roleSort",key:"roleSort",align:"center"},{title:"状态",dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:"创建人",dataIndex:"createdBy",key:"createdBy",align:"center"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"操作",key:"action",align:"center",slots:{customRender:"action"}}];var Q=k({components:{FormSearch:b},setup(){const e=_([]),t={roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],status:[{required:!0,message:"状态不能为空",trigger:"change"}],menuIds:[{required:!0,validator:()=>P.value.length?Promise.resolve():Promise.reject("菜单权限为空"),trigger:"change"}]},o=C({pageNum:1,pageSize:10,roleName:"",status:""}),r=C([{type:"input",label:"角色名称",name:"roleName",value:"",placeholder:"请输入角色名称"},{type:"select",label:"状态",name:"status",value:void 0,placeholder:"请选择角色状态",normalizer:{value:"dictValue",label:"dictLabel"},options:e}]),s=_([]),m=_({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`共 ${e} 条`}),f=C({selectedRowKeys:[]}),b=w((()=>f.selectedRowKeys.length>0)),k=e=>{d(e).then((e=>{console.log(e),s.value=e.data.rows,m.value.total=e.data.count,f.selectedRowKeys=[],s.value.forEach((e=>{"1"===e.status?e.checked=!0:e.checked=!1}))}))},x=_(),j=C({id:void 0,roleName:void 0,roleKey:void 0,roleSort:1,status:"1",menuIds:void 0,remark:void 0}),{open:I,drawerTitle:U}=S();console.log(I);const F=_([]),P=_([]),q=()=>{v().then((e=>{F.value=h(e.data.rows,"id","parentId").tree}))},T=C([{value:"1",label:"本部门及以下数据权限"},{value:"2",label:"本部门数据权限"},{value:"3",label:"仅本人数据权限"}]),z=_(),A=_(!1),D=C({id:void 0,roleName:"",roleKey:"",roleSort:void 0,status:void 0,menuIds:void 0,remark:void 0,dataScope:void 0});return K((async()=>{e.value=await g("sys_normal_disable"),console.log(e),k(o),q()})),L=n({queryParams:o,formFields:r,handleQuery:e=>{m.value.current=1,o.pageNum=m.value.current,o.roleName=e.roleName,o.status=e.status,k(o)},roleList:s,columns:E,pagination:m,handleTableChange:e=>{m.value=e,o.pageNum=m.value.current,o.pageSize=m.value.pageSize,k(o)},selectDictLabel:y,statusOptions:e},O(f)),a(L,l({hasSelected:b,onSelectChange:e=>{console.log("selectedRowKeys changed: ",e),f.selectedRowKeys=e},open:I,drawerTitle:U,formState:j,labelCol:{span:4},wrapperCol:{span:20},rules:t,formRef:x,handleClose:()=>{j.id=void 0,P.value=[],x.value.resetFields(),console.log(x),I.value=!1},handleSubmit:()=>{console.log(j,P),x.value.validate().then((()=>{j.menuIds=P.value,j.id?c(j).then((e=>{N.success(e.message),k(o),j.id=void 0,x.value.resetFields(),I.value=!1})):u(j).then((e=>{N.success(e.message),k(o),j.id=void 0,x.value.resetFields(),I.value=!1}))})).catch((e=>{console.log("error",e)}))},confirm:e=>{const a=e.id||f.selectedRowKeys;i(a).then((()=>{k(o),N.success("删除成功")}))},cancel:e=>{console.log(e),N.success("取消删除")},handleAdd:()=>{I.value=!0,U.value="添加角色"},handleUpdate:e=>{p(e.id).then((e=>{I.value=!0,U.value="修改角色",R((()=>{Object.keys(j).forEach((a=>{j[a]=e.data[a]})),P.value=e.data.menus.map((e=>e.id))}))}))},menuOptions:F,checkedKeys:P,replaceFields:{children:"children",title:"title",key:"id"},dataScopeOptions:T,formScopeRef:z,dataScopeOpen:A,formScopeState:D,scopeRules:{dataScope:[{required:!0,message:"权限范围不能为空",trigger:"blur"}]},handleScopeOpen:e=>{p(e.id).then((e=>{A.value=!0,R((()=>{Object.keys(D).forEach((a=>{D[a]=e.data[a]})),D.menuIds=e.data.menus.map((e=>e.id))}))}))},handleScopeClose:()=>{A.value=!1},handleScopeSubmit:()=>{z.value.validate().then((()=>{console.log("ok"),c(D).then((e=>{N.success(e.message),A.value=!1,k(o)}))})).catch((e=>{console.log("error",e)}))}}));var L},computed:n({},m(f,["loading"]))});const B={class:"p-4"},V={class:"mb-3"},$=L(" 新增 "),G=L(" 删除 "),H={class:"text-[#1890ff]"},J=L(" 修改 "),M=L(" 数据权限 "),W=L(" 删除 "),X=L(" 确认 "),Y=L("取消"),Z=L(" 确认 "),ee=L("取消");Q.render=function(e,a,l,t,o,r){const s=x("form-search"),n=x("a-button"),d=x("a-col"),c=x("a-popconfirm"),u=x("a-row"),i=x("router-link"),p=x("a-table"),m=x("a-input"),f=x("a-form-item"),v=x("a-input-number"),h=x("a-radio-group"),b=x("a-tree"),g=x("a-textarea"),y=x("a-form"),S=x("a-drawer"),k=x("a-select-option"),_=x("a-select"),C=j("has-permi");return I(),U("div",B,[F("div",V,[F(s,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),F(u,{gutter:10,class:"mb-2"},{default:P((()=>[q(F(d,null,{default:P((()=>[F(n,{color:"success",onClick:e.handleAdd},{default:P((()=>[$])),_:1},8,["onClick"])])),_:1},512),[[C,["system:role:add"]]]),q(F(d,null,{default:P((()=>[F(c,{title:"确定要删除选中数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:e.confirm,onCancel:e.cancel},{default:P((()=>[F(n,{disabled:!e.hasSelected,color:"error"},{default:P((()=>[G])),_:1},8,["disabled"])])),_:1},8,["onConfirm","onCancel"])])),_:1},512),[[C,["system:role:delete"]]])])),_:1}),F(p,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.roleList,pagination:e.pagination,onChange:e.handleTableChange},{roleKey:P((({record:e})=>[F(i,{to:"dictData/"+e.id},{default:P((()=>[F("span",H,T(e.roleKey),1)])),_:2},1032,["to"])])),status:P((({record:a})=>[F("span",null,T(e.selectDictLabel(e.statusOptions,a.status)),1)])),action:P((({record:a})=>[F("span",null,[q(F(n,{type:"link",color:"success",class:"mr-3",onClick:l=>e.handleUpdate(a)},{default:P((()=>[J])),_:2},1032,["onClick"]),[[C,["system:role:update"]]]),q(F(n,{type:"link",color:"warning",class:"mr-3",onClick:l=>e.handleScopeOpen(a)},{default:P((()=>[M])),_:2},1032,["onClick"]),[[C,["system:role:update"]]]),F(c,{title:"确定要删除该数据吗？","ok-text":"确定","cancel-text":"取消",onConfirm:l=>e.confirm(a),onCancel:e.cancel},{default:P((()=>[q(F(n,{type:"link",color:"error"},{default:P((()=>[W])),_:1},512),[[C,["system:role:delete"]]])])),_:2},1032,["onConfirm","onCancel"])])])),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),F(S,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[7]||(a[7]=a=>e.open=a),maskClosable:!1,onClose:e.handleClose},{default:P((()=>[e.open?(I(),U(y,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:P((()=>[F(u,null,{default:P((()=>[F(d,{span:24},{default:P((()=>[F(f,{label:"角色名称",name:"roleName"},{default:P((()=>[F(m,{value:e.formState.roleName,"onUpdate:value":a[1]||(a[1]=a=>e.formState.roleName=a),placeholder:"请输入角色名称"},null,8,["value"])])),_:1})])),_:1}),F(d,{span:24},{default:P((()=>[F(f,{label:"权限字符",name:"roleKey"},{default:P((()=>[F(m,{value:e.formState.roleKey,"onUpdate:value":a[2]||(a[2]=a=>e.formState.roleKey=a),placeholder:"请输入权限字符"},null,8,["value"])])),_:1})])),_:1}),F(d,{span:24},{default:P((()=>[F(f,{label:"显示排序",name:"roleSort"},{default:P((()=>[F(v,{class:"!w-[100%]",value:e.formState.roleSort,"onUpdate:value":a[3]||(a[3]=a=>e.formState.roleSort=a),placeholder:"请输入显示排序"},null,8,["value"])])),_:1})])),_:1}),F(d,{span:24},{default:P((()=>[F(f,{label:"状态",name:"status"},{default:P((()=>[F(h,{value:e.formState.status,"onUpdate:value":a[4]||(a[4]=a=>e.formState.status=a),name:"menuType",options:[{label:"正常",value:"1"},{label:"停用",value:"0"}]},null,8,["value"])])),_:1})])),_:1}),F(d,{span:24},{default:P((()=>[F(f,{label:"菜单权限",name:"menuIds"},{default:P((()=>[F(b,{blockNode:!0,checkable:"","replace-fields":e.replaceFields,"tree-data":e.menuOptions,checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":a[5]||(a[5]=a=>e.checkedKeys=a)},null,8,["replace-fields","tree-data","checkedKeys"])])),_:1})])),_:1}),F(d,{span:24},{default:P((()=>[F(f,{label:"备注",name:"remark"},{default:P((()=>[F(g,{rows:3,value:e.formState.remark,"onUpdate:value":a[6]||(a[6]=a=>e.formState.remark=a),placeholder:"请输入备注"},null,8,["value"])])),_:1})])),_:1}),F(d,{span:24},{default:P((()=>[F(f,null,{default:P((()=>[F(n,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:P((()=>[X])),_:1},8,["onClick"]),F(n,{onClick:e.handleClose},{default:P((()=>[Y])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","label-col","wrapper-col"])):z("",!0)])),_:1},8,["title","visible","onClose"]),F(S,{width:"540px",title:"分配数据权限",placement:"right",visible:e.dataScopeOpen,"onUpdate:visible":a[11]||(a[11]=a=>e.dataScopeOpen=a),maskClosable:!1,onClose:e.handleScopeClose},{default:P((()=>[e.dataScopeOpen?(I(),U(y,{key:0,ref:"formScopeRef",model:e.formScopeState,rules:e.scopeRules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:P((()=>[F(u,null,{default:P((()=>[F(d,{span:24},{default:P((()=>[F(f,{label:"角色名称",name:"roleName"},{default:P((()=>[F(m,{disabled:!0,value:e.formScopeState.roleName,"onUpdate:value":a[8]||(a[8]=a=>e.formScopeState.roleName=a),placeholder:"请输入角色名称"},null,8,["value"])])),_:1})])),_:1}),F(d,{span:24},{default:P((()=>[F(f,{label:"权限字符",name:"roleKey"},{default:P((()=>[F(m,{disabled:!0,value:e.formScopeState.roleKey,"onUpdate:value":a[9]||(a[9]=a=>e.formScopeState.roleKey=a),placeholder:"请输入权限字符"},null,8,["value"])])),_:1})])),_:1}),F(d,{span:24},{default:P((()=>[F(f,{label:"权限范围",name:"dataScope"},{default:P((()=>[F(_,{value:e.formScopeState.dataScope,"onUpdate:value":a[10]||(a[10]=a=>e.formScopeState.dataScope=a),placeholder:"请选择权限范围"},{default:P((()=>[(I(!0),U(A,null,D(e.dataScopeOptions,(e=>(I(),U(k,{key:e.value},{default:P((()=>[L(T(e.label),1)])),_:2},1024)))),128))])),_:1},8,["value"])])),_:1})])),_:1}),F(d,{span:24},{default:P((()=>[F(f,null,{default:P((()=>[F(n,{type:"primary",class:"mr-3",onClick:e.handleScopeSubmit},{default:P((()=>[Z])),_:1},8,["onClick"]),F(n,{onClick:e.handleScopeClose},{default:P((()=>[ee])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","label-col","wrapper-col"])):z("",!0)])),_:1},8,["visible","onClose"])])};export default Q;
